@page
@model NetflixLibrosRazor.Pages.Libros.IndexLibrosModel
@{
    ViewData["Title"] = "Netflix de Libros";
}

<link rel="stylesheet" href="~/css/libros.css" asp-append-version="true" />

<header>
    <h1>Netflix de Libros</h1>
    <p>Explora una selecciÃ³n de libros recomendados.</p>

    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <div>
            <p style="margin: 0; color: #666;">Conectado como: <strong>@Model.UsuarioEmail</strong></p>
            @if (Model.RolUsuario == (int)NetflixLibrosRazor.Models.RolUsuario.Administrador)
            {
                <p style="margin: 5px 0 0 0; color: #d9534f;"><strong>ðŸ‘¤ Rol: Administrador</strong></p>
            }
            else
            {
                <p style="margin: 5px 0 0 0; color: #5cb85c;"><strong>ðŸ‘¤ Rol: Usuario</strong></p>
            }
        </div>
        <div class="menu-container">
            <div class="hamburger">&#9776;</div>
            <nav class="menu">
                <a href="/Libros/Crear">âž• Crear Libro</a>
                @if (Model.RolUsuario == (int)NetflixLibrosRazor.Models.RolUsuario.Administrador)
                {
                    <a href="/Admin/Usuarios">ðŸ‘¥ Gestionar Usuarios</a>
                }
                <a href="/" onclick="return confirm('Â¿Deseas cerrar sesiÃ³n?');">ðŸšª Cerrar SesiÃ³n</a>
            </nav>
        </div>
    </div>

    <form method="get">
        <input type="text" name="SearchTerm" value="@Model.SearchTerm" placeholder="Buscar libro..." />
        <button type="submit">Buscar</button>
    </form>
</header>

<section class="libros">
    @foreach (var libro in Model.Libros)
    {
        <article class="libro" onclick="mostrarDetalles('libro_@libro.IdLibro')">
            <img src="@libro.Imagen" alt="@libro.Titulo" />
            <h2>@libro.Titulo</h2>

            <div id="libro_@libro.IdLibro" class="detalles" style="display:none;">
                <a href="@libro.UrlLibro" target="_blank">Leer libro</a>
                <p><strong>Autor:</strong> @libro.Autor</p>
                <p><strong>GÃ©nero:</strong> @libro.Genero</p>
                <p><strong>Sinopsis:</strong> @libro.Sinopsis</p>

                <!-- BotÃ³n Eliminar solo para administrador (rol = 1) -->
                @if (Model.RolUsuario == (int)NetflixLibrosRazor.Models.RolUsuario.Administrador)
                {
                    <form method="post" asp-page-handler="Eliminar" asp-route-id="@libro.IdLibro"
                          onsubmit="return confirm('Â¿EstÃ¡s seguro de que quieres eliminar este libro? Esta acciÃ³n no se puede deshacer.');">
                        <button type="submit" class="btn-eliminar">Eliminar Libro</button>
                    </form>
                }
            </div>
        </article>
    }
</section>

<script>
    const hamburger = document.querySelector('.hamburger');
    const menu = document.querySelector('.menu');

    hamburger.addEventListener('click', () => {
        menu.classList.toggle('active');
    });

    function mostrarDetalles(id) {
        const detalles = document.getElementById(id);
        detalles.style.display = detalles.style.display === "none" ? "block" : "none";
    }
</script>
